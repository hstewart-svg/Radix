<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radix | Transformation Architect</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,800&display=swap');
        * { font-family: 'Plus Jakarta Sans', sans-serif !important; }
        body { letter-spacing: 0.01em; background: #fcfdfe; color: #1e293b; }
        .nav-glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(16px); border-bottom: 1px solid #f1f5f9; }
        .card-shadow { box-shadow: 0 10px 40px -12px rgba(0,0,0,0.05); }
        .text-header { font-weight: 800; font-style: italic; letter-spacing: -0.04em; }
        
        /* Fixed height for the Architect Pane to ensure usability */
        .architect-pane { 
            max-height: 75vh; 
            overflow-y: auto; 
            overflow-x: hidden; 
            padding-right: 10px;
        }
        
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        
        /* Grid layout to prevent horizontal cut-off */
        .dna-grid {
            display: grid;
            grid-template-columns: 280px 1fr 200px 240px;
            gap: 24px;
            align-items: start;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        const EUROPE_INVENTORY = ["Austria", "Belgium", "Denmark", "Finland", "France", "Germany", "Ireland", "Italy", "Luxembourg", "Netherlands", "Norway", "Spain", "Sweden", "Switzerland", "United Kingdom"];
        const GROUPS = { "DACH": ["Germany", "Austria", "Switzerland"], "Nordics": ["Denmark", "Finland", "Norway", "Sweden"], "Benelux": ["Belgium", "Netherlands", "Luxembourg"] };

        const App = () => {
            const [view, setView] = useState('home');
            const [csvInput, setCsvInput] = useState("");
            const [levers, setLevers] = useState({
                localRate: 115, coeRate: 45, internalAuditRate: 125, externalAuditRate: 245,
                autoTestTarget: 2, coeEfficiencyLift: 35
            });

            const [rcmData, setRcmData] = useState([
                { id: 1, cycle: "P2P", process: "AP", sub: "Payments", controlName: "PMT-01", activity: "Manager reviews the automated payment proposal report and manually matches the total values to the weekly invoice register before signing off and releasing the bank transmission to ensure completeness and accuracy of cash outflows.", country: "Italy", group: "Other", execH: 140, testH: 60, status: "Local", nature: "Manual", complexity: 1.2, wave: 1 },
                { id: 2, cycle: "P2P", process: "AP", sub: "Payments", controlName: "PMT-01", activity: "Local accounts payable clerk verifies the batch totals against the physical file transmission and obtains wet-ink signature from the Finance Director for all payments exceeding a €50k threshold.", country: "Germany", group: "DACH", execH: 110, testH: 40, status: "Local", nature: "Manual", complexity: 1.0, wave: 1 }
            ]);

            const analysis = useMemo(() => {
                const results = rcmData.reduce((acc, c) => {
                    const localCost = c.execH * levers.localRate;
                    if (c.status === "COE") {
                        const netLift = levers.coeEfficiencyLift / c.complexity;
                        const coeCost = (c.execH * (1 - (netLift/100))) * levers.coeRate;
                        acc.opSavings += (localCost - coeCost);
                    }
                    if (c.nature === "Automated") {
                        acc.auditSavings += ((c.testH - levers.autoTestTarget) * levers.externalAuditRate);
                    }
                    return acc;
                }, { opSavings: 0, auditSavings: 0 });

                const fragments = {};
                rcmData.forEach(item => {
                    if (!fragments[item.controlName]) fragments[item.controlName] = [];
                    fragments[item.controlName].push(item);
                });

                return { ...results, fragments };
            }, [rcmData, levers]);

            const updateNode = (id, field, value) => {
                setRcmData(rcmData.map(n => {
                    if (n.id !== id) return n;
                    let u = { ...n, [field]: value };
                    if (field === 'country') u.group = Object.keys(GROUPS).find(g => GROUPS[g].includes(value)) || "Other";
                    return u;
                }));
            };

            const StructuralLogo = () => (
                <div className="flex items-center gap-4">
                    <svg width="32" height="32" viewBox="0 0 40 40" fill="none"><rect x="8" y="8" width="6" height="24" rx="1.5" fill="#4F46E5"/><path d="M14 8H24C28.4 8 32 11.6 32 16C32 20.4 28.4 24 24 24H14V8Z" fill="#4F46E5" fillOpacity="0.8"/><path d="M22 24L30 32H22L14 24H22Z" fill="#4F46E5"/></svg>
                    <div className="flex flex-col">
                        <span className="text-2xl text-header text-slate-900 leading-none italic uppercase">Radix</span>
                        <span className="text-[9px] font-bold text-indigo-600 uppercase tracking-widest mt-1 italic">Transformation Architect</span>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen">
                    <nav className="nav-glass sticky top-0 z-50 px-10 py-5 flex justify-between items-center">
                        <button onClick={() => setView('home')}><StructuralLogo /></button>
                        <div className="flex gap-10">
                            <button onClick={() => setView('home')} className={`text-[10px] font-extrabold uppercase tracking-widest ${view==='home'?'text-indigo-600 underline underline-offset-8':'text-slate-400'}`}>Map</button>
                            <button onClick={() => setView('ingest')} className={`text-[10px] font-extrabold uppercase tracking-widest ${view==='ingest'?'text-indigo-600 underline underline-offset-8':'text-slate-400'}`}>Architect</button>
                        </div>
                    </nav>

                    <main className="max-w-[1400px] mx-auto p-12 space-y-12">
                        {view === 'home' && (
                            <div className="space-y-12 animate-in fade-in duration-700">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                                    <div className="bg-indigo-950 p-12 rounded-[3rem] text-white card-shadow border-l-8 border-emerald-400">
                                        <h3 className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-2 italic">Operational Dividend</h3>
                                        <p className="text-5xl font-extrabold italic text-emerald-400">${Math.round(analysis.opSavings).toLocaleString()}</p>
                                    </div>
                                    <div className="bg-white p-12 rounded-[3rem] border border-slate-100 flex flex-col justify-center">
                                        <h3 className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 italic">Audit Dividend</h3>
                                        <p className="text-5xl font-extrabold italic text-indigo-600">${Math.round(analysis.auditSavings).toLocaleString()}</p>
                                    </div>
                                </div>
                                <div className="space-y-8">
                                    <h2 className="text-3xl text-header text-slate-900 italic uppercase">Process DNA Overlap</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                        {Object.entries(analysis.fragments).map(([name, nodes]) => (
                                            <div key={name} className={`p-10 rounded-[3rem] border-2 card-shadow bg-white ${nodes.length > 1 ? 'border-rose-100' : 'border-slate-50'}`}>
                                                <h3 className="text-xl text-header text-slate-900 uppercase italic mb-6">{name}</h3>
                                                <div className="space-y-4">
                                                    {nodes.map(n => (
                                                        <div key={n.id} className="bg-slate-50/50 p-4 rounded-2xl border border-slate-100 flex justify-between items-center">
                                                            <span className="text-[11px] font-black uppercase italic">{n.country}</span>
                                                            <p className="text-[11px] font-medium text-slate-500 italic truncate ml-4 max-w-[200px]">"{n.activity}"</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'ingest' && (
                            <div className="space-y-10 animate-in slide-in-from-bottom-8 duration-500">
                                <div className="flex justify-between items-end bg-white p-10 rounded-[3rem] card-shadow border border-slate-100">
                                    <div className="max-w-xl">
                                        <h2 className="text-4xl text-header text-slate-900 italic uppercase tracking-tighter">Transformation Architect</h2>
                                        <p className="text-slate-500 font-medium italic mt-2">Adjust complexity and transformation levers to see real-time ROI impact.</p>
                                    </div>
                                    <button onClick={()=>setRcmData([{id: Date.now(), cycle: "NEW", process: "NEW", sub: "", controlName: "NEW-CTRL", activity: "", country: "Germany", group: "DACH", execH: 40, testH: 20, status: "Local", nature: "Manual", complexity: 1.0, wave: 1}, ...rcmData])} className="bg-indigo-600 text-white px-10 py-4 rounded-[1.5rem] font-bold uppercase text-[10px] tracking-widest shadow-xl shadow-indigo-100 hover:bg-indigo-700 transition-all">Add Control DNA</button>
                                </div>

                                <div className="architect-pane custom-scroll">
                                    <div className="space-y-6">
                                        {rcmData.map((c) => (
                                            <div key={c.id} className="bg-white p-10 rounded-[3rem] border border-slate-100 card-shadow dna-grid">
                                                {/* Column 1: Hierarchy */}
                                                <div>
                                                    <input value={c.controlName} onChange={e=>updateNode(c.id, 'controlName', e.target.value)} className="text-xl text-header italic uppercase outline-none w-full bg-transparent text-indigo-950 placeholder-slate-200" placeholder="CTRL-NAME" />
                                                    <div className="flex gap-2 mt-3">
                                                        <input value={c.cycle} onChange={e=>updateNode(c.id, 'cycle', e.target.value)} className="text-[10px] font-black text-indigo-400 uppercase bg-transparent w-12" placeholder="CYC" />
                                                        <input value={c.process} onChange={e=>updateNode(c.id, 'process', e.target.value)} className="text-[10px] font-bold text-slate-300 uppercase bg-transparent w-full" placeholder="PROCESS" />
                                                    </div>
                                                </div>

                                                {/* Column 2: Activity (The Centerpiece) */}
                                                <div>
                                                    <textarea value={c.activity} onChange={e=>updateNode(c.id, 'activity', e.target.value)} className="w-full bg-slate-50 p-6 rounded-3xl text-[12px] font-medium italic border-none h-32 custom-scroll leading-relaxed focus:ring-2 focus:ring-indigo-100" placeholder="Enter control activity narrative..." />
                                                </div>

                                                {/* Column 3: Metadata */}
                                                <div className="space-y-4 px-4">
                                                    <select value={c.country} onChange={e=>updateNode(c.id, 'country', e.target.value)} className="bg-slate-50 p-3 rounded-xl text-[11px] font-black uppercase outline-none w-full border-none">
                                                        {EUROPE_INVENTORY.map(co => <option key={co} value={co}>{co}</option>)}
                                                    </select>
                                                    <div className="flex justify-between items-center bg-slate-50/50 p-3 rounded-xl">
                                                        <span className="text-[9px] font-bold text-slate-400 uppercase italic">Complexity</span>
                                                        <input type="number" step="0.1" value={c.complexity} onChange={e=>updateNode(c.id, 'complexity', Number(e.target.value))} className="w-10 text-xs font-black text-center bg-transparent outline-none text-indigo-600" />
                                                    </div>
                                                </div>

                                                {/* Column 4: Strategic Action */}
                                                <div className="flex flex-col gap-3 items-stretch">
                                                    <button onClick={()=>updateNode(c.id, 'status', c.status==='Local'?'COE':'Local')} className={`p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-center ${c.status==='COE' ? 'bg-emerald-500 text-white shadow-lg' : 'bg-slate-900 text-white opacity-90'}`}>
                                                        {c.status==='Local' ? 'Shift to COE Hub' : '✓ Standardized'}
                                                    </button>
                                                    <button onClick={()=>updateNode(c.id, 'nature', c.nature==='Manual'?'Automated':'Manual')} className={`p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-center ${c.nature==='Automated' ? 'bg-emerald-500 text-white shadow-lg' : 'bg-indigo-600 text-white opacity-90'}`}>
                                                        {c.nature==='Manual' ? 'Automate Control' : '✓ Automated'}
                                                    </button>
                                                    <button onClick={()=>setRcmData(rcmData.filter(n=>n.id!==c.id))} className="text-[9px] font-black text-rose-300 uppercase italic mt-2 text-center hover:text-rose-500">Remove Node</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* CSV INGEST (Bottom) */}
                                <div className="bg-slate-900 p-12 rounded-[4rem] text-white shadow-2xl mt-12">
                                    <h3 className="text-xl text-header text-indigo-400 mb-6 uppercase italic">Bulk RCM Osmosis</h3>
                                    <textarea value={csvInput} onChange={e=>setCsvInput(e.target.value)} placeholder="Cycle, Process, Sub, Name, Activity, Country, ExecH, TestH, Comp" className="w-full h-32 bg-slate-800 rounded-2xl p-8 text-xs font-mono text-indigo-300 focus:outline-none ring-1 ring-slate-700" />
                                    <button onClick={()=>handleCsv()} className="w-full bg-indigo-600 p-5 rounded-xl font-black uppercase text-[10px] tracking-widest mt-8 hover:bg-indigo-500 transition-all">Execute Bulk Ingest</button>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
